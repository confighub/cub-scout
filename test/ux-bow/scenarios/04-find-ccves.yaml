# Scenario: Find configuration vulnerabilities (CCVEs)
# Security/quality journey - identify misconfigurations

id: find-ccves
name: Find configuration vulnerabilities (CCVEs)
category: audit
priority: P1
difficulty_target: easy

description: |
  User wants to find configuration anti-patterns and potential issues
  in their cluster. CCVEs (Configuration Common Vulnerabilities & Exposures)
  are patterns known to cause problems.

  Key question: "What's misconfigured in my cluster?"

personas:
  - security           # Primary - "compliance scan"
  - platform-engineer  # Primary - "quality audit"
  - developer          # Secondary - "am I doing it wrong?"

preconditions:
  cluster: any
  has_resources: true

goals:
  - See list of detected CCVEs
  - Understand severity distribution
  - Find resources affected by each CCVE
  - Get remediation guidance

entry_points:
  tui:
    description: "Using cub-scout map TUI"
    expected_keystrokes: 1
    expected_commands: 1
    difficulty: trivial
    journey:
      - step: 1
        action: "Press 'c' for CCVE scan view"
        expect: "Full-screen scan showing stuck reconciliations, Kyverno violations, CCVE counts"
        keystrokes: 1
    notes: |
      'c' opens full-screen scan interactive mode.
      Shows both state issues (stuck resources) and policy violations.

  cli:
    description: "Using cub-scout scan command"
    expected_keystrokes: 15
    expected_commands: 1
    difficulty: easy
    journey:
      - step: 1
        command: "cub-scout scan"
        expect: "Table of CCVEs with severity, count, category"
        keystrokes: 13
      - step: 2
        command: "cub-scout scan --ccve=CCVE-2025-0027"
        expect: "Details for specific CCVE with affected resources"
        keystrokes: 35

  hub:
    description: "Using ConfigHub hierarchy - fleet CCVE view"
    expected_keystrokes: 4
    expected_commands: 1
    difficulty: easy
    journey:
      - step: 1
        action: "Press 'c' or navigate to CCVEs section"
        expect: "Fleet-wide CCVE summary across all clusters"
        keystrokes: 1
      - step: 2
        action: "Drill into specific CCVE"
        expect: "See which clusters/resources are affected"
        keystrokes: 3

scoring:
  discoverability:
    tui: 4  # CCVE view exists but 'c' key not obvious
    cli: 5  # 'scan' command is clearly named
    hub: 4  # IMPROVED: 'cub-scout scan' in help overlay
  speed:
    tui: 5  # Single keystroke to see all CCVEs
    cli: 5  # Short command
    hub: 4  # Few keystrokes
  consistency:
    tui: 4  # Consistent with other views
    cli: 5  # Scan always works same way
    hub: 4  # Consistent hierarchy pattern
  recovery:
    tui: 5  # Esc returns to main view
    cli: 5  # Re-run with different flags
    hub: 5  # Back navigation
  delight:
    tui: 5  # Severity colors, clear categories
    cli: 4  # Clean table output
    hub: 4  # Fleet context valuable

composite_scores:
  tui: 4.6    # Excellent
  cli: 4.85   # Excellent
  hub: 4.2    # IMPROVED from 3.95: scan command in help

notes: |
  CLI slightly edges TUI because 'scan' is an obvious command.
  Hub improved with 'cub-scout scan' prominently in help overlay.
  All entry points now score well for this core use case.
