# Scenario: Trace resource ownership
# Core visibility journey - understand the full ownership chain

id: trace-ownership
name: Trace resource ownership chain
category: discover
priority: P0
difficulty_target: trivial

description: |
  User sees a resource and needs to understand:
  - Who/what manages it (Flux, ArgoCD, Helm, Native)
  - The full chain from pod up to git source
  - Which git repo/path controls the config

  Key question: "Where do I change this?"

personas:
  - developer          # Primary - "where's the YAML for this?"
  - platform-engineer  # Primary - "understanding structure"
  - sre                # Secondary - "incident triage"

preconditions:
  cluster: any
  resource_exists: true
  gitops_tool: any

goals:
  - See immediate owner (what manages this resource)
  - See full ownership chain to git source
  - Find exact git repo/path for the source

entry_points:
  tui:
    description: "Using cub-agent map TUI with panel layout"
    expected_keystrokes: 1
    expected_commands: 1
    difficulty: trivial
    journey:
      - step: 1
        action: "Press 't' for trace view"
        expect: "Full-screen interactive trace: select resource, see full ownership chain (Pod → RS → Deploy → Kustomization → GitRepository → repo URL)"
        keystrokes: 1
    notes: |
      't' opens full-screen interactive trace mode.
      Select resource from list, then see complete ownership chain.

  cli:
    description: "Using cub-agent trace command"
    expected_keystrokes: 40
    expected_commands: 1
    difficulty: easy
    journey:
      - step: 1
        command: "cub-agent trace deploy/myapp -n prod"
        expect: "Ownership chain with git source at root"
        keystrokes: 35

  hub:
    description: "Using ConfigHub hierarchy - trace from unit"
    expected_keystrokes: 6
    expected_commands: 2
    difficulty: easy
    journey:
      - step: 1
        action: "Navigate to unit in hierarchy"
        expect: "Unit details showing linked resources"
        keystrokes: 3
      - step: 2
        action: "Press Enter or 't' for trace view"
        expect: "Full trace from ConfigHub unit to k8s resources"
        keystrokes: 1

scoring:
  discoverability:
    tui: 5  # 't' for trace is intuitive
    cli: 5  # 'trace' command is self-documenting
    hub: 4  # Trace available but less obvious
  speed:
    tui: 5  # Single keystroke
    cli: 3  # Need to type resource path
    hub: 4  # Few keystrokes in hierarchy
  consistency:
    tui: 5  # 't' works on any resource type
    cli: 5  # Same syntax for all resources
    hub: 5  # Same trace view everywhere
  recovery:
    tui: 5  # Esc returns to list
    cli: 5  # Re-run with different resource
    hub: 5  # Back navigation works
  delight:
    tui: 5  # Visual chain with arrows and icons
    cli: 4  # ASCII tree structure
    hub: 5  # Hierarchy context adds value

composite_scores:
  tui: 5.0    # Perfect
  cli: 4.35   # Good
  hub: 4.6    # Excellent

notes: |
  This is THE core feature - understanding ownership.
  All entry points score well because it's the primary use case.
  TUI wins on speed, Hub wins on context, CLI wins on scriptability.
