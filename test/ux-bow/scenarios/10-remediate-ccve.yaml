# Scenario: Remediate a CCVE
# Action journey - fix a detected issue

id: remediate-ccve
name: Remediate a configuration vulnerability
category: remediate
priority: P1
difficulty_target: medium

description: |
  User found a CCVE in their cluster and wants to fix it.
  Options:
  - Dry-run to see what would change
  - Apply fix with safety checks
  - Audit trail for compliance

  Key question: "How do I safely fix this?"

personas:
  - platform-engineer  # Primary - "fixing misconfigs"
  - security           # Primary - "compliance remediation"
  - sre                # Secondary - "quick fix during incident"

preconditions:
  cluster: any
  has_ccve: true
  ccve_is_auto_fixable: true

goals:
  - Understand what the fix will do (dry-run)
  - Apply fix safely with validation
  - Have audit trail of remediation

entry_points:
  tui:
    description: "Using cub-agent map TUI with integrated fix"
    expected_keystrokes: 5
    expected_commands: 1
    difficulty: easy
    journey:
      - step: 1
        action: "Press 'c' for CCVE scan, see numbered findings"
        expect: "Scan shows numbered fixable issues with CCVE IDs"
        keystrokes: 1
      - step: 2
        action: "Press 'f' to fix, select issue number"
        expect: "Dry-run preview showing planned changes"
        keystrokes: 2
      - step: 3
        action: "Confirm with 'y' to apply fix"
        expect: "Fix applied, scan refreshes"
        keystrokes: 1
    notes: |
      TUI scan view now has integrated fix flow:
      - 'c' opens scan with numbered findings
      - 'f' prompts for issue number, shows dry-run preview
      - Confirm to apply, auto-refreshes scan results

  cli:
    description: "Using cub-agent remedy command"
    expected_keystrokes: 50
    expected_commands: 2
    difficulty: medium
    journey:
      - step: 1
        command: "cub-agent remedy CCVE-2025-0147 --dry-run -n prod"
        expect: "Shows planned changes without applying"
        keystrokes: 45
      - step: 2
        command: "cub-agent remedy CCVE-2025-0147 -n prod"
        expect: "Applies fix, shows result, logs to audit file"
        keystrokes: 38

  hub:
    description: "Using ConfigHub hierarchy - bulk remediation"
    expected_keystrokes: 15
    expected_commands: 3
    difficulty: medium
    journey:
      - step: 1
        action: "Navigate to CCVEs across fleet"
        expect: "Fleet-wide CCVE view"
        keystrokes: 3
      - step: 2
        action: "Select CCVE type to remediate"
        expect: "List of affected clusters/resources"
        keystrokes: 5
      - step: 3
        action: "Initiate bulk remediation"
        expect: "Dry-run across fleet, confirm, apply"
        keystrokes: 7

scoring:
  discoverability:
    tui: 5  # IMPROVED: 'f' key shown in scan view, numbered findings
    cli: 4  # 'remedy' command is well-named
    hub: 3  # Bulk remediation flow needs documentation
  speed:
    tui: 5  # IMPROVED: 'c' → 'f' → confirm = 3-4 keystrokes
    cli: 3  # Typing CCVE ID takes time
    hub: 4  # Fleet-wide is efficient for bulk
  consistency:
    tui: 5  # IMPROVED: 'f' for fix follows vim-like patterns
    cli: 5  # Command structure consistent
    hub: 4  # Follows hierarchy patterns
  recovery:
    tui: 5  # Dry-run preview, confirm before apply
    cli: 5  # Dry-run flag, audit trail
    hub: 5  # Dry-run across fleet
  delight:
    tui: 5  # IMPROVED: Integrated flow with preview and confirmation
    cli: 4  # Clear output with risk level
    hub: 5  # Fleet-wide remediation is powerful

composite_scores:
  tui: 5.0    # IMPROVED: Integrated 'f' fix flow in scan view
  cli: 4.15   # Good
  hub: 4.15   # Good

notes: |
  TUI now has integrated fix flow:
  - 'c' opens scan with numbered fixable issues
  - 'f' key triggers fix: shows dry-run preview, confirm to apply
  - Auto-refreshes scan after fix applied
  CLI is still useful for scripting/automation.
  Hub excels for fleet-wide remediation (bulk fix).
